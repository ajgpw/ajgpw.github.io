<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>m3u8 Downloader (Browser)</title>
  <style>
    body {
      background:#0f172a;
      color:#e5e7eb;
      font-family:system-ui,sans-serif;
      padding:20px;
    }
    input,button {
      width:100%;
      padding:10px;
      margin-top:10px;
      font-size:16px;
    }
    button {
      background:#3b82f6;
      border:none;
      color:white;
    }
    pre {
      background:#020617;
      padding:10px;
      height:220px;
      overflow:auto;
      margin-top:10px;
      font-size:13px;
    }
  </style>
</head>
<body>

<h2>m3u8 Downloader（非ライブ / DRMなし）</h2>

<input id="url" placeholder="https://example.com/video.m3u8">
<button id="start">Download</button>

<pre id="log"></pre>

<!-- ✅ UMD版 ffmpeg.wasm -->
<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.6/dist/umd/ffmpeg.js"></script>

<script>
  const logEl = document.getElementById("log");
  const log = (m) => {
    logEl.textContent += m + "\n";
    logEl.scrollTop = logEl.scrollHeight;
  };

  const { FFmpeg } = FFmpegWASM;
  const ffmpeg = new FFmpeg();

  document.getElementById("start").onclick = async () => {
    const url = document.getElementById("url").value.trim();
    if (!url) return alert("m3u8 URLを入力して");

    try {
      log("ffmpeg 読み込み中...");
      await ffmpeg.load({
        coreURL: "https://unpkg.com/@ffmpeg/core@0.12.6/dist/ffmpeg-core.js"
      });

      log("変換開始...");
      await ffmpeg.exec([
        "-i", url,
        "-c", "copy",
        "output.mp4"
      ]);

      log("読み出し中...");
      const data = await ffmpeg.readFile("output.mp4");

      const blob = new Blob([data.buffer], { type:"video/mp4" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "video.mp4";
      a.click();

      log("完了！");
    } catch (e) {
      log("エラー: " + e.message);
      console.error(e);
    }
  };
</script>

</body>
</html>
