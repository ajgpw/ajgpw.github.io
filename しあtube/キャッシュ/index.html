<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>キャッシュ確認</title>
<style>
  body { 
    font-family: Arial, sans-serif; 
    margin: 20px; 
    background-color: #fff; 
    color: #000;
  }
  h2 { margin-bottom: 20px; }
  .cache-item { 
    border: 1px solid #ddd; 
    border-radius: 8px; 
    padding: 12px; 
    margin-bottom: 10px; 
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }
  .cache-header { 
    cursor: pointer; 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    font-weight: normal; 
    font-size: 16px;
  }
  .cache-details { 
    display: none; 
    margin-top: 10px; 
    padding-left: 5px; 
  }
  button { 
    padding: 6px 12px; 
    margin-bottom: 20px; 
    cursor: pointer;
  }
  .toggle-btn {
    background-color: #eee;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 2px 6px;
    font-size: 12px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h2>しあtube動画キャッシュ</h2>
<button id="refreshBtn">更新</button>
<div id="cacheContainer">読み込み中...</div>

<script>
const CACHE_URL = "https://siawaseok.f5.si/api/2/cache";

async function fetchCache() {
  try {
    const res = await fetch(CACHE_URL);
    if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
    const data = await res.json();
    displayCache(data);
  } catch (err) {
    document.getElementById("cacheContainer").innerText = "取得失敗: " + err;
  }
}

function displayCache(data) {
  const container = document.getElementById("cacheContainer");
  container.innerHTML = ""; // クリア

  Object.entries(data).forEach(([id, info]) => {
    const item = document.createElement("div");
    item.className = "cache-item";

    const header = document.createElement("div");
    header.className = "cache-header";

    const title = document.createElement("span");
    title.innerText = id;

    const toggleBtn = document.createElement("span");
    toggleBtn.className = "toggle-btn";
    toggleBtn.innerText = "詳細表示";
    
    header.appendChild(title);
    header.appendChild(toggleBtn);
    item.appendChild(header);

    const details = document.createElement("div");
    details.className = "cache-details";
    details.innerHTML = `
      <div>経過時間: ${info.age_sec} 秒</div>
      <div>残り時間: ${info.remaining_sec} 秒</div>
      <div>有効期間: ${info.duration_sec} 秒</div>
    `;
    item.appendChild(details);

    toggleBtn.onclick = () => {
      if(details.style.display === "none") {
        details.style.display = "block";
        toggleBtn.innerText = "詳細を隠す";
      } else {
        details.style.display = "none";
        toggleBtn.innerText = "詳細表示";
      }
    };

    container.appendChild(item);
  });
}

document.getElementById("refreshBtn").addEventListener("click", fetchCache);

// 初回ロード
fetchCache();
</script>

</body>
</html>
